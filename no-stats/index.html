<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±—É—á–∞–ª–∫–∞ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        #card-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        #card-image {
            width: 300px;
            height: 300px;
            object-fit: contain;
            display: block;
            margin: 10px auto;
        }
        .button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border-radius: 6px;
            cursor: pointer;
            touch-action: manipulation;
            transition: background-color 0.2s;
        }
        #range-container .button {
            background-color: #4b5563; /* gray-600 */
            color: white;
        }
        #range-container .button:hover {
            background-color: #374151; /* gray-700 */
        }
        #mode-button {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        #mode-button:hover {
            background-color: #2563eb; /* blue-600 */
        }
        #next-button {
            background-color: #1f2937; /* gray-800 */
            color: white;
        }
        #next-button:hover {
            background-color: #111827; /* gray-900 */
        }
        #auto-button {
            background-color: #22c55e; /* green-500 */
            color: white;
        }
        #auto-button:hover {
            background-color: #16a34a; /* green-600 */
        }
        #feedback {
            margin-top: 10px;
            font-weight: bold;
        }
        #range-container, #order-container, #delay-container {
            margin: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        #card-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            font-size: 5rem;
            font-weight: bold;
            flex-wrap: wrap;
        }
        #mode-title {
            font-size: 2.5rem;
            font-weight: bold;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        #button-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        #options-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .option {
            padding: 8px 16px;
            background-color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            user-select: none;
        }
        .option:hover {
            background-color: #d0d0d0;
        }
        .option.selected {
            background-color: #4CAF50;
            color: white;
        }
        @media (max-width: 600px) {
            #card-header {
                font-size: 3rem;
            }
            #mode-title {
                font-size: 1.8rem;
            }
            #range-container .button, #button-container .button {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            #delay-container select {
                font-size: 0.9rem;
                padding: 5px;
            }
            .option {
                padding: 6px 12px;
                font-size: 0.9rem;
            }
            #card-image {
                width: 200px;
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div id="card-container">
        <h1 id="mode-title">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h1>
        <div id="range-container">
            <label for="range-start">–û—Ç:</label>
            <input type="number" id="range-start" min="0" max="99" value="0">
            <label for="range-end">–î–æ:</label>
            <input type="number" id="range-end" min="0" max="99" value="9">
            <button class="button" onclick="updateRange()" title="–û–±–Ω–æ–≤–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω">‚Üª</button>
        </div>
        <div id="order-container">
            <label><input type="radio" name="order" value="sequential" checked> –ü–æ –ø–æ—Ä—è–¥–∫—É</label>
            <label><input type="radio" name="order" value="random"> –°–ª—É—á–∞–π–Ω–æ</label>
        </div>
        <div id="delay-container">
            <label for="delay-select" id="delay-label">–í—Ä–µ–º—è –ø–æ–∫–∞–∑–∞ (—Å–µ–∫):</label>
            <select id="delay-select">
                <option value="500">0.5</option>
                <option value="1000">1</option>
                <option value="2000" selected>2</option>
            </select>
            <label for="answer-time-select" id="answer-time-label">–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (—Å–µ–∫):</label>
            <select id="answer-time-select">
                <option value="1000">1</option>
                <option value="2000">2</option>
                <option value="3000">3</option>
                <option value="4000">4</option>
                <option value="5000" selected>5</option>
                <option value="6000">6</option>
                <option value="7000">7</option>
                <option value="8000">8</option>
                <option value="9000">9</option>
                <option value="10000">10</option>
            </select>
        </div>
        <div id="card-header">
            <span id="card-digit"></span>
            <span id="card-text"></span>
        </div>
        <img id="card-image" src="" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
        <div id="options-container"></div>
        <div id="feedback"></div>
        <div id="button-container">
            <button class="button" id="mode-button" onclick="toggleMode()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ">üîÑ</button>
            <button class="button" id="next-button" onclick="nextCard()" title="–°–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞">‚ñ∂‚ñ∂</button>
            <button class="button" id="auto-button" onclick="toggleAutoPlay()" title="–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ">‚ñ∂</button>
        </div>
    </div>

    <script>
        let cards = { single_digits: [], double_digits: [] };
        let currentCardIndex = 0;
        let currentCards = [];
        let isMemorizationMode = true;
        let isAutoPlay = false;
        let autoPlayTimeout = null;
        let answerTimeout = null;
        let selectedLetter = null;
        let selectedWord = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ JSON
        fetch('Flashcards/cards.json')
            .then(response => {
                if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å cards.json');
                return response.json();
            })
            .then(data => {
                cards = data;
                updateRange();
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON:', error);
                document.getElementById('card-digit').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
            });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
        function updateRange() {
            const start = parseInt(document.getElementById('range-start').value);
            const end = parseInt(document.getElementById('range-end').value);
            const order = document.querySelector('input[name="order"]:checked').value;
            currentCards = [];

            if (start <= 9 && end <= 9) {
                currentCards = cards.single_digits.slice(start, end + 1);
            } else {
                const singleDigits = start <= 9 ? cards.single_digits.slice(start, Math.min(end + 1, 10)) : [];
                const doubleDigits = cards.double_digits.filter(card => {
                    const num = parseInt(card.number);
                    return num >= Math.max(start, 0) && num <= end;
                });
                currentCards = [...singleDigits, ...doubleDigits];
            }

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
            if (order === 'random') {
                currentCards = currentCards.sort(() => Math.random() - 0.5);
            }

            currentCardIndex = 0;
            showCard();
            stopAutoPlay();
            stopAnswerTimer();
        }

        // –ü–æ–∫–∞–∑ –∫–∞—Ä—Ç–æ—á–∫–∏
        function showCard() {
            if (currentCards.length === 0) {
                document.getElementById('card-digit').textContent = '–ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ';
                document.getElementById('card-text').textContent = '';
                document.getElementById('card-image').src = '';
                document.getElementById('card-image').style.display = 'none';
                document.getElementById('options-container').innerHTML = '';
                document.getElementById('next-button').style.display = 'none';
                document.getElementById('auto-button').style.display = 'block';
                document.getElementById('feedback').textContent = '';
                document.getElementById('delay-label').style.display = isAutoPlay ? 'inline-block' : 'none';
                document.getElementById('delay-select').style.display = isAutoPlay ? 'inline-block' : 'none';
                document.getElementById('answer-time-label').style.display = 'none';
                document.getElementById('answer-time-select').style.display = 'none';
                return;
            }

            const card = currentCards[currentCardIndex];
            const isSingleDigit = 'digit' in card;
            document.getElementById('card-digit').textContent = isSingleDigit ? card.digit : card.number;
            document.getElementById('card-text').textContent = isMemorizationMode ? (isSingleDigit ? card.letter : card.word) : '';
            const imagePath = isMemorizationMode ? `images/${encodeURIComponent(card.image)}` : '';
            document.getElementById('card-image').src = imagePath;
            document.getElementById('card-image').style.display = isMemorizationMode ? 'block' : 'none';
            document.getElementById('next-button').style.display = isAutoPlay ? 'none' : 'block';
            document.getElementById('auto-button').style.display = 'block';
            document.getElementById('delay-label').style.display = isAutoPlay ? 'inline-block' : 'none';
            document.getElementById('delay-select').style.display = isAutoPlay ? 'inline-block' : 'none';
            document.getElementById('answer-time-label').style.display = isMemorizationMode ? 'none' : 'inline-block';
            document.getElementById('answer-time-select').style.display = isMemorizationMode ? 'none' : 'inline-block';
            document.getElementById('feedback').textContent = '';
            selectedLetter = null;
            selectedWord = null;

            // –ü–æ–∫–∞–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            if (!isMemorizationMode) {
                if (isSingleDigit) {
                    // –î–ª—è 0-9: 5 –±—É–∫–≤ –∏ 5 —Å–ª–æ–≤ –≤ –¥–≤—É—Ö —Ä—è–¥–∞—Ö
                    const letters = getRandomOptions(cards.single_digits, 'letter', card.letter, 5);
                    const words = getRandomOptions(cards.single_digits, 'word', card.word, 5);
                    const letterDiv = document.createElement('div');
                    letterDiv.className = 'options-row';
                    letterDiv.style.display = 'flex';
                    letterDiv.style.gap = '10px';
                    letterDiv.style.flexWrap = 'wrap';
                    letterDiv.style.justifyContent = 'center';
                    letters.forEach(letter => {
                        const option = document.createElement('div');
                        option.className = 'option';
                        option.textContent = letter;
                        option.onclick = () => selectOption(option, 'letter', letter);
                        letterDiv.appendChild(option);
                    });
                    const wordDiv = document.createElement('div');
                    wordDiv.className = 'options-row';
                    wordDiv.style.display = 'flex';
                    wordDiv.style.gap = '10px';
                    wordDiv.style.flexWrap = 'wrap';
                    wordDiv.style.justifyContent = 'center';
                    words.forEach(word => {
                        const option = document.createElement('div');
                        option.className = 'option';
                        option.textContent = word;
                        option.onclick = () => selectOption(option, 'word', word);
                        wordDiv.appendChild(option);
                    });
                    optionsContainer.appendChild(letterDiv);
                    optionsContainer.appendChild(wordDiv);
                } else {
                    // –î–ª—è 10-99: 5 —Å–ª–æ–≤ –≤ –æ–¥–Ω–æ–º —Ä—è–¥—É
                    const words = getRandomOptions(cards.double_digits, 'word', card.word, 5);
                    const wordDiv = document.createElement('div');
                    wordDiv.className = 'options-row';
                    wordDiv.style.display = 'flex';
                    wordDiv.style.gap = '10px';
                    wordDiv.style.flexWrap = 'wrap';
                    wordDiv.style.justifyContent = 'center';
                    words.forEach(word => {
                        const option = document.createElement('div');
                        option.className = 'option';
                        option.textContent = word;
                        option.onclick = () => selectOption(option, 'word', word);
                        wordDiv.appendChild(option);
                    });
                    optionsContainer.appendChild(wordDiv);
                }
                startAnswerTimer();
            }

            // –ó–∞–ø—É—Å–∫ —Å–ª–∞–π–¥-—à–æ—É –≤ —Ä–µ–∂–∏–º–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            if (isAutoPlay && isMemorizationMode) {
                const delay = parseInt(document.getElementById('delay-select').value);
                autoPlayTimeout = setTimeout(nextCard, delay);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
        function getRandomOptions(sourceArray, key, correctValue, count) {
            const options = [correctValue];
            const available = sourceArray.filter(item => item[key] !== correctValue).map(item => item[key]);
            for (let i = 0; i < count - 1; i++) {
                if (available.length === 0) break;
                const randomIndex = Math.floor(Math.random() * available.length);
                options.push(available.splice(randomIndex, 1)[0]);
            }
            return options.sort(() => Math.random() - 0.5); // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ
        }

        // –í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞
        function selectOption(element, type, value) {
            if (type === 'letter') {
                if (selectedLetter) {
                    selectedLetter.classList.remove('selected');
                }
                selectedLetter = element;
                selectedLetter.classList.add('selected');
            } else {
                if (selectedWord) {
                    selectedWord.classList.remove('selected');
                }
                selectedWord = element;
                selectedWord.classList.add('selected');
            }

            const card = currentCards[currentCardIndex];
            const isSingleDigit = 'digit' in card;
            if (isSingleDigit && selectedLetter && selectedWord) {
                checkAnswer();
            } else if (!isSingleDigit && selectedWord) {
                checkAnswer();
            }
        }

        // –°–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞
        function toggleMode() {
            isMemorizationMode = !isMemorizationMode;
            document.getElementById('mode-title').textContent = isMemorizationMode ? '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞' : '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ';
            document.getElementById('mode-button').title = isMemorizationMode ? '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' : '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫—É';
            stopAutoPlay();
            stopAnswerTimer();
            showCard();
        }

        // –°–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
        function nextCard() {
            const order = document.querySelector('input[name="order"]:checked').value;
            if (order === 'random') {
                currentCardIndex = Math.floor(Math.random() * currentCards.length);
            } else {
                currentCardIndex = (currentCardIndex + 1) % currentCards.length;
            }
            showCard();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
        function checkAnswer() {
            stopAnswerTimer();
            const card = currentCards[currentCardIndex];
            const isSingleDigit = 'digit' in card;
            const correctLetter = isSingleDigit ? card.letter : null;
            const correctWord = card.word;
            const feedback = document.getElementById('feedback');
            let isCorrect = false;

            if (isSingleDigit) {
                isCorrect = selectedLetter?.textContent === correctLetter && selectedWord?.textContent === correctWord;
                feedback.textContent = isCorrect
                    ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!'
                    : `–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctLetter}, ${correctWord}`;
            } else {
                isCorrect = selectedWord?.textContent === correctWord;
                feedback.textContent = isCorrect
                    ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!'
                    : `–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctWord}`;
            }

            feedback.style.color = isCorrect ? 'green' : 'red';
            document.getElementById('options-container').innerHTML = '';
            if (isAutoPlay && !isMemorizationMode) {
                const delay = parseInt(document.getElementById('delay-select').value);
                autoPlayTimeout = setTimeout(nextCard, delay);
            }
        }

        // –¢–∞–π–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
        function startAnswerTimer() {
            stopAnswerTimer();
            if (!isMemorizationMode) {
                const answerTime = parseInt(document.getElementById('answer-time-select').value);
                answerTimeout = setTimeout(() => {
                    const card = currentCards[currentCardIndex];
                    const isSingleDigit = 'digit' in card;
                    const correctLetter = isSingleDigit ? card.letter : null;
                    const correctWord = card.word;
                    const feedback = document.getElementById('feedback');
                    feedback.textContent = isSingleDigit
                        ? `–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctLetter}, ${correctWord}`
                        : `–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctWord}`;
                    feedback.style.color = 'red';
                    document.getElementById('options-container').innerHTML = '';
                    if (isAutoPlay) {
                        const delay = parseInt(document.getElementById('delay-select').value);
                        autoPlayTimeout = setTimeout(nextCard, delay);
                    }
                }, answerTime);
            }
        }

        function stopAnswerTimer() {
            if (answerTimeout) {
                clearTimeout(answerTimeout);
                answerTimeout = null;
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ–º
        function toggleAutoPlay() {
            isAutoPlay = !isAutoPlay;
            const autoButton = document.getElementById('auto-button');
            autoButton.textContent = isAutoPlay ? '‚è∏' : '‚ñ∂';
            autoButton.title = isAutoPlay ? '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ' : '–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ';
            document.getElementById('next-button').style.display = isAutoPlay ? 'none' : 'block';
            document.getElementById('delay-label').style.display = isAutoPlay ? 'inline-block' : 'none';
            document.getElementById('delay-select').style.display = isAutoPlay ? 'inline-block' : 'none';
            if (isAutoPlay) {
                if (isMemorizationMode) {
                    // –ó–∞–ø—É—Å–∫ —Å–ª–∞–π–¥-—à–æ—É –≤ —Ä–µ–∂–∏–º–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                    const delay = parseInt(document.getElementById('delay-select').value);
                    autoPlayTimeout = setTimeout(nextCard, delay);
                } else {
                    // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ä–µ–∂–∏–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    checkAnswer();
                }
            } else {
                stopAutoPlay();
                stopAnswerTimer();
            }
        }

        function stopAutoPlay() {
            isAutoPlay = false;
            const autoButton = document.getElementById('auto-button');
            autoButton.textContent = '‚ñ∂';
            autoButton.title = '–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ';
            document.getElementById('next-button').style.display = 'block';
            document.getElementById('delay-label').style.display = 'none';
            document.getElementById('delay-select').style.display = 'none';
            if (autoPlayTimeout) {
                clearTimeout(autoPlayTimeout);
                autoPlayTimeout = null;
            }
        }
    </script>
</body>
</html>